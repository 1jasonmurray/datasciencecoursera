---
title: "HAR - Correct Dumbbell Curl"
author: "Jason Murray"
date: '2017-02-27'
output: html_document
---

##Summary

##Data Import and Cleaning

####Required Libraries
```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(caret)
library(parallel)
library(doParallel)
```
   

The data for this analysis was obtained from the following locations:   
Training Data: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv   
Testing Data: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

Information about this data and it's source can be found here:   
http://groupware.les.inf.puc-rio.br/har   

```{r}
##Data download and import.
train_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
test_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"

data_dir <- "./data"
train_file <- paste(data_dir, "/pml-training.csv", sep = "")
test_file <- paste(data_dir, "/pml-testing.csv", sep = "")

#download.file(train_url,train_file)
#download.file(test_url,test_file)

training <- read.csv(train_file, stringsAsFactors = FALSE)
testing <- read.csv(test_file, stringsAsFactors = FALSE)

str(training)

```

Right away we can see that are a lot of missing and NA values in our data.  Let's see how many lines are complete.  

```{r}
sum(complete.cases(training))
```

Taking a quick look at the data it looks like there are summary lines for each window.  There is a column labeled new_window, when set to yes the line is complete.  Let's double check this assumption.    

```{r}
nw_yes <- training %>% filter(new_window=='yes')
dim(nw_yes)
```

So this corresponds to our complete cases.  Looking at the testing data there are no summary lines.  Based on this I'm not sure if the summary values are going to be of value in building a model to make predictions.  Let's clean up our data by keeping only the columns that have values for all entries.  Let's also exclude anything that isn't likely to be predictive, including the index number, user_name, timestamps, and the window number.   

```{r}
training <- training %>% select(matches("^(roll|pitch|yaw|total_accel|gyros|accel|magnet|classe)"))
```
    

Let's also change the classe variable to a factor.

```{r}
training$classe <- as.factor(training$classe)
```

##Model Creation and Testing

```{r, cache=TRUE, message=FALSE, warning=FALSE}
## Set up parallel processing
cluster <- makeCluster(detectCores() - 1) 
registerDoParallel(cluster)

set.seed(42)
rf_ctrl <- trainControl(method = "cv", number = 10, allowParallel=TRUE)
model_rf <- train(classe ~ ., data=training, model='rf', preProcess = c("center", "scale"), trControl = rf_ctrl)
```



